<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Счётчик напитков</title>
    <style>
        @font-face {
            font-family: 'Junegull';
            src: url('Junegull.ttf') format('truetype');
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            font-family: 'Junegull', sans-serif;
            background-color: #F4A6D7;
            overflow: hidden;
            transition: all 0.5s ease;
        }
    h1 {
        font-size: 30vw;
        margin-bottom: 20px;
        margin: 0;
        width: 100%;
        text-align: center;
        color: #0047BB; /* Тёмно-синий цвет текста */
        -webkit-text-stroke: 4px white; /* Белая обводка текста */
        text-stroke: 4px white;
        font-weight: normal; /* Junegull не имеет вариаций веса */
    }
    button#clickButton {
        font-size: 2rem;
        padding: 15px 30px;
        cursor: pointer;
        border: none;
        background-color: #0047BB; /* Синий фон кнопки */
        color: white; /* Белый текст */
        border-radius: 30px; /* Скруглённые углы */
        max-width: 90%;
        font-family: 'Junegull', sans-serif;
        font-weight: normal;
    }clickButton:disabled { background-color: #666; cursor: not-allowed; }
        p { font-size: 1.5rem; color: #0047BB; font-family: 'Junegull', sans-serif; }
        #editButton {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1rem;
            padding: 10px;
            background-color: transparent;
            color: #0047BB;
            border: none;
            opacity: 0.5;
            font-family: 'Junegull', sans-serif;
        }
        #editButton:hover { opacity: 1; }
        .hidden { opacity: 0; height: 0; margin: 0; pointer-events: none; }
        .expanded { font-size: 40vw; width: 100%; height: 100vh; display: flex; align-items: center; justify-content: center; }
        .full-button { width: 80%; height: 60%; font-size: 4rem; }
    </style>
</head>
<body>
    <h1 id="counter">500</h1>
    <button id="clickButton">Забрать напиток</button>
    <p id="message"></p>
    <button id="editButton">ED</button>

    <!-- Подключаем Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

    <script>
        // Инициализация Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyABGFrmc4SRwuuQIkdEWhydg-ru19O0ROk",
            authDomain: "tomi-348c8.firebaseapp.com",
            databaseURL: "https://tomi-348c8-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "tomi-348c8",
            storageBucket: "tomi-348c8.firebasestorage.app",
            messagingSenderId: "805956552785",
            appId: "1:805956552785:web:11e9369f282abb25081070",
            measurementId: "G-6F31PYWZ4H"
        };

        // Инициализируем Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase успешно инициализирован");
        } catch (error) {
            console.error("Ошибка инициализации Firebase:", error);
            alert("Не удалось подключиться к Firebase. Проверьте интернет и настройки.");
            return;
        }

        const db = firebase.database();
        const counterRef = db.ref('counter');

        let count = 500; // Локальная переменная только для начального отображения
        let isEditMode = false;
        const counterEl = document.getElementById('counter');
        const buttonEl = document.getElementById('clickButton');
        const messageEl = document.getElementById('message');
        const editButtonEl = document.getElementById('editButton');

        // Устанавливаем начальное значение в Firebase, если его нет
        counterRef.once('value', (snapshot) => {
            if (!snapshot.exists()) {
                counterRef.set(500)
                    .then(() => console.log("Установлено начальное значение 500 в Firebase"))
                    .catch((error) => console.error("Ошибка установки начального значения:", error));
            }
        }).catch((error) => console.error("Ошибка при проверке базы:", error));

        // Синхронизация с Firebase
        counterRef.on('value', (snapshot) => {
            count = snapshot.val() !== null ? snapshot.val() : 500;
            counterEl.textContent = count;
            updateUI();
            console.log("Счётчик обновлён из Firebase:", count);
        }, (error) => {
            console.error("Ошибка чтения из Firebase:", error);
            alert("Ошибка чтения данных из Firebase. Проверьте консоль.");
        });

        // Уменьшение счётчика
        function decreaseCounter() {
            console.log("Кнопка 'Забрать напиток' нажата");
            if (count > 0) {
                count--;
                counterRef.set(count)
                    .then(() => console.log("Счётчик уменьшен до:", count))
                    .catch((error) => console.error("Ошибка записи в Firebase:", error));
            }
        }

        // Обновление интерфейса
        function updateUI() {
            console.log("Обновление UI, count:", count);
            if (count === 0) {
                messageEl.textContent = "Все напитки, к сожалению, уже раздали.";
                buttonEl.disabled = true;
            } else {
                messageEl.textContent = "";
                buttonEl.disabled = false;
            }
        }

        // Переключение режима и редактирование
        function editAndToggleMode() {
            console.log("Кнопка 'ED' нажата, текущий режим:", isEditMode);

            // Запрашиваем новое значение счётчика
            const newCount = prompt("Отредактировать количество напитков (оставьте пустым для переключения режима):", count);
            if (newCount !== null && newCount !== "" && !isNaN(newCount) && newCount >= 0) {
                count = parseInt(newCount);
                counterRef.set(count)
                    .then(() => console.log("Счётчик отредактирован до:", count))
                    .catch((error) => console.error("Ошибка редактирования в Firebase:", error));
            }

            // Переключаем режим
            if (!isEditMode) {
                buttonEl.classList.add('hidden');
                counterEl.classList.add('expanded');
                messageEl.classList.add('hidden');
                console.log("Переключено в режим расширенного счётчика");
            } else {
                counterEl.classList.remove('expanded');
                counterEl.classList.add('hidden');
                buttonEl.classList.remove('hidden');
                buttonEl.classList.add('full-button');
                console.log("Переключено в режим большой кнопки");
            }
            isEditMode = !isEditMode;
        }

        // Привязка событий
        buttonEl.onclick = decreaseCounter;
        editButtonEl.onclick = editAndToggleMode;

        // Инициализация интерфейса
        updateUI();
    </script>
</body>
</html>
