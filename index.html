<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Счётчик напитков</title>
    <style>
        @font-face {
            font-family: 'Junegull';
            src: url('Junegull.ttf') format('truetype');
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            font-family: 'Junegull', sans-serif;
            background-color: #F4A6D7;
            overflow: hidden;
            transition: all 0.5s ease;
        }
        h1 {
            font-size: 30vw;
            margin: 0;
            width: 100%;
            text-align: center;
            color: #0047BB;
            -webkit-text-stroke: 4px white;
            text-stroke: 4px white;
            font-weight: normal;
        }
    button#clickButton {
        font-size: 6rem;
        padding: 60px 75px;
        cursor: pointer;
        border: none;
        background-color: #0047BB; /* Синий фон кнопки */
        color: white; /* Белый текст */
        border-radius: 30px; /* Скруглённые углы */
        max-width: 90%;
        font-family: 'Junegull', sans-serif;
        font-weight: normal;
    }

    button#clickButton:disabled {
        background-color: #666; /* Серый фон для отключённой кнопки */
        cursor: not-allowed;
    }

        p { 
            font-size: 1.5rem; 
            color: #0047BB; 
            font-family: 'Junegull', sans-serif; 
            text-align: center; 
            margin-top: 10px; 
        }
        #editButton {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1rem;
            padding: 10px;
            background-color: transparent;
            color: #0047BB;
            border: none;
            opacity: 0.5;
            font-family: 'Junegull', sans-serif;
        }
        #editButton:hover { opacity: 1; }
        .hidden { opacity: 0; height: 0; margin: 0; pointer-events: none; }
        .expanded { font-size: 40vw; width: 100%; height: 100vh; display: flex; align-items: center; justify-content: center; }
        .full-button { 
            font-size: 2rem; /* Уменьшен размер кнопки в режиме кнопки */
            padding: 15px 30px; 
            width: auto; /* Убрана фиксированная ширина */
            height: auto; /* Убрана фиксированная высота */
            margin-top: 20px; 
        }
    </style>
</head>
<body>
    <h1 id="counter">500</h1>
    <button id="clickButton">Забрать напиток</button>
    <p id="message"></p>
    <button id="editButton">ED</button>

    <!-- Подключаем Firebase через CDN -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js';
        import { getDatabase, ref, set, onValue } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js';

        // Конфигурация Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyABGFrmc4SRwuuQIkdEWhydg-ru19O0ROk",
            authDomain: "tomi-348c8.firebaseapp.com",
            databaseURL: "https://tomi-348c8-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "tomi-348c8",
            storageBucket: "tomi-348c8.firebasestorage.app",
            messagingSenderId: "805956552785",
            appId: "1:805956552785:web:11e9369f282abb25081070",
            measurementId: "G-6F31PYWZ4H"
        };

        // Инициализация Firebase
        let app, db, counterRef;
        let firebaseInitialized = false;
        try {
            app = initializeApp(firebaseConfig);
            db = getDatabase(app);
            counterRef = ref(db, 'counter');
            firebaseInitialized = true;
            console.log("Firebase успешно инициализирован");
        } catch (error) {
            console.error("Ошибка инициализации Firebase:", error);
            alert("Не удалось подключиться к Firebase. Кнопки будут работать локально.");
        }

        let count = 500;
        let isEditMode = false;
        const counterEl = document.getElementById('counter');
        const buttonEl = document.getElementById('clickButton');
        const messageEl = document.getElementById('message');
        const editButtonEl = document.getElementById('editButton');

        // Инициализация Firebase и синхронизация
        if (firebaseInitialized) {
            onValue(counterRef, (snapshot) => {
                if (!snapshot.exists()) {
                    set(counterRef, 500)
                        .then(() => console.log("Установлено начальное значение 500"))
                        .catch((error) => console.error("Ошибка установки значения:", error));
                } else {
                    count = snapshot.val();
                    counterEl.textContent = count;
                    updateUI();
                    console.log("Счётчик загружен из Firebase:", count);
                }
            }, { onlyOnce: true });

            onValue(counterRef, (snapshot) => {
                count = snapshot.val() !== null ? snapshot.val() : 500;
                counterEl.textContent = count;
                updateUI();
                console.log("Счётчик обновлён из Firebase:", count);
            }, (error) => {
                console.error("Ошибка чтения из Firebase:", error);
            });
        } else {
            counterEl.textContent = count;
            updateUI();
            console.warn("Firebase не работает, используем локальный режим");
        }

        // Уменьшение счётчика
        function decreaseCounter() {
            console.log("Кнопка 'Забрать напиток' нажата, текущий count:", count);
            if (count > 0) {
                count--;
                if (firebaseInitialized) {
                    set(counterRef, count)
                        .then(() => console.log("Счётчик уменьшен до:", count))
                        .catch((error) => console.error("Ошибка записи в Firebase:", error));
                } else {
                    counterEl.textContent = count;
                    updateUI();
                    console.log("Локально уменьшен до:", count);
                }
            }
        }

        // Обновление интерфейса
        function updateUI() {
            console.log("Обновление UI, count:", count);
            if (count === 0) {
                messageEl.textContent = "Все напитки, к сожалению, уже раздали.";
                buttonEl.disabled = true;
            } else {
                messageEl.textContent = "";
                buttonEl.disabled = false;
            }
        }

        // Переключение режима и редактирование
        function editAndToggleMode() {
            console.log("Кнопка 'ED' нажата, текущий режим:", isEditMode);
            const input = prompt("Введите:\n1 - режим счётчика\n2 - режим кнопки\nили число для редактирования счётчика:", "");
            
            if (input === null) return; // Ничего не делаем при "Отмена"

            if (input === "1") {
                buttonEl.classList.add('hidden');
                counterEl.classList.remove('hidden');
                counterEl.classList.add('expanded');
                messageEl.classList.add('hidden');
                isEditMode = false;
                console.log("Переключено в режим счётчика");
            } else if (input === "2") {
                counterEl.classList.remove('expanded');
                counterEl.classList.add('hidden');
                buttonEl.classList.remove('hidden');
                buttonEl.classList.add('full-button');
                isEditMode = true;
                console.log("Переключено в режим кнопки");
            } else if (!isNaN(input) && input !== "" && parseInt(input) >= 0) {
                count = parseInt(input);
                if (firebaseInitialized) {
                    set(counterRef, count)
                        .then(() => console.log("Счётчик отредактирован до:", count))
                        .catch((error) => console.error("Ошибка записи в Firebase:", error));
                } else {
                    counterEl.textContent = count;
                    updateUI();
                    console.log("Локально отредактирован до:", count);
                }
            } else {
                console.log("Некорректный ввод, ничего не изменено");
            }
        }

        // Привязка событий
        buttonEl.onclick = decreaseCounter;
        editButtonEl.onclick = editAndToggleMode;

        // Инициализация интерфейса
        updateUI();
    </script>
</body>
</html>
